syntax = "proto3";

package humanoid_robot.PB.common;

// Date type (YYYY-MM-DD)
message Date {
  int32 year = 1;   // 年份，如 2025
  int32 month = 2;  // 月份，1-12
  int32 day = 3;    // 日期，1-31
}

// Timestamp type (with nanosecond precision)
message Timestamp {
  int64 seconds = 1;      // 自1970年1月1日UTC以来的秒数
  int32 nanos = 2;        // 纳秒部分 (0-999,999,999)
}

// Array types for all supported data types
message BoolArray {
  repeated bool values = 1;
}

message Int8Array {
  repeated int32 values = 1;  // protobuf uses int32 for int8
}

message UInt8Array {
  repeated uint32 values = 1;  // protobuf uses uint32 for uint8
}

message Int16Array {
  repeated int32 values = 1;  // protobuf uses int32 for int16
}

message UInt16Array {
  repeated uint32 values = 1;  // protobuf uses uint32 for uint16
}

message Int32Array {
  repeated int32 values = 1;
}

message UInt32Array {
  repeated uint32 values = 1;
}

message Int64Array {
  repeated int64 values = 1;
}

message UInt64Array {
  repeated uint64 values = 1;
}

message FloatArray {
  repeated float values = 1;
}

message DoubleArray {
  repeated double values = 1;
}

message CharArray {
  repeated string values = 1;  // 每个元素是一个字符
}

message ByteArray {
  bytes values = 1;  // 字节数组
}

message StringArray {
  repeated string values = 1;
}

// Dictionary for key-value storage
message Dictionary {
  map<string, Variant> keyValueList = 1;        // 数据字典
}

// 检测框
message BBox{
  float x1 = 1;  // 左上角x
  float y1 = 2;  // 左上角y
  float x2 = 3;  // 右下角x
  float y2 = 4;  // 右下角y
}

// 分割掩码mask
message Mask {
    int32 x = 1;
    int32 y = 2;
}

message Image{
    bytes timeStamp = 1;
    bytes img = 2; 
    bool requiresMasks = 3;
}

message PerceptionRow {
    BBox bbox = 1;
    repeated Mask masks = 2;
    string trackId = 3;     // 跟踪id
    float conf = 4;         // 检测框的置信度
    string cls = 5;         // 检测框的类别
    bool isMove = 6;        // 新增动态物体标记
}

message DetectionRow {
    BBox bbox = 1;
    string trackId = 2;     // 跟踪id
    float conf = 3;         // 检测框的置信度
    string cls = 4;         // 检测框的类别
    bool isMove = 5;        // 新增动态物体标记
}

message DivisionRow {
    string trackId = 1;     // 跟踪id
    float conf = 2;         // 检测框的置信度
    string cls = 3;         // 检测框的类别
    bool isMove = 4;        // 新增动态物体标记
    repeated Mask masks = 5;
}

// Simple and efficient Variant using oneof (type field removed — use value_case() to detect)
message Variant {
  // Type enumeration for runtime type checking (nested enum)
  enum Type {
    KUnknownValue = 0;
    // Basic types (matching oneof tags)
    KBoolValue = 2;
    KInt8Value = 3;
    KUint8Value = 4;
    KInt16Value = 5;
    KUint16Value = 6;
    KInt32Value = 7;
    KUint32Value = 8;
    KInt64Value = 9;
    KUint64Value = 10;
    KFloatValue = 11;
    KDoubleValue = 12;
    KCharValue = 13;
    KByteValue = 14;
    KStringValue = 15;
    KDateValue = 16;
    KTimestampValue = 17;
    KDictValue = 18;
    KImageValue = 19; // Image for Perception
    KBBoxValue = 20; // Bounding box for Perception
    KMaskValue = 21; // Mask for Perception
    KPerceptionRowValue = 22; // Perception row for Perception
    KDetectionRowValue = 23; // Detection row for Perception
    KDivisionRowValue = 24; // Division row for Perception

    // Array types
    KBoolArrayValue = 102;
    KInt8ArrayValue = 103;
    KUint8ArrayValue = 104;
    KInt16ArrayValue = 105;
    KUint16ArrayValue = 106;
    KInt32ArrayValue = 107;
    KUint32ArrayValue = 108;
    KInt64ArrayValue = 109;
    KUint64ArrayValue = 110;
    KFloatArrayValue = 111;
    KDoubleArrayValue = 112;
    KCharArrayValue = 113;
    KByteArrayValue = 114;
    KStringArrayValue = 115;
  }

  // NOTE: explicit 'type' field removed. Use value_case() or oneof checks at runtime.

  oneof value {
    // Basic types
    bool boolValue = 2;
    int32 int8Value = 3;      // int8 stored as int32
    uint32 uint8Value = 4;    // uint8 stored as uint32
    int32 int16Value = 5;     // int16 stored as int32
    uint32 uint16Value = 6;   // uint16 stored as uint32
    int32 int32Value = 7;
    uint32 uint32Value = 8;
    int64 int64Value = 9;
    uint64 uint64Value = 10;
    float floatValue = 11;
    double doubleValue = 12;
    uint32 charValue = 13;    // single character as uint8 stored in uint32
    bytes byteValue = 14;     // single byte
    string stringValue = 15;
    Date dateValue = 16;
    Timestamp timestampValue = 17;
    Dictionary dictValue = 18;
    Image imageValue = 19;    // Image for Perception
    BBox bboxValue = 20;      // Bounding box for Perception
    Mask maskValue = 21;      // Mask for Perception
    PerceptionRow perceptionRowValue = 22; // Perception row for Perception
    DetectionRow detectionRowValue = 23; // Detection row for Perception
    DivisionRow divisionRowValue = 24; // Division row for Perception

    // Array types
    BoolArray boolArrayValue = 102;
    Int8Array int8ArrayValue = 103;
    UInt8Array uint8ArrayValue = 104;
    Int16Array int16ArrayValue = 105;
    UInt16Array uint16ArrayValue = 106;
    Int32Array int32ArrayValue = 107;
    UInt32Array uint32ArrayValue = 108;
    Int64Array int64ArrayValue = 109;
    UInt64Array uint64ArrayValue = 110;
    FloatArray floatArrayValue = 111;
    DoubleArray doubleArrayValue = 112;
    CharArray charArrayValue = 113;
    ByteArray byteArrayValue = 114;
    StringArray stringArrayValue = 115;
  }
}
